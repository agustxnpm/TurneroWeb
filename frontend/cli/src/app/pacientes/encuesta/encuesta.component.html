<div class="encuesta-container" *ngIf="!loading">
  <div class="encuesta-card">
    <!-- Encabezado -->
    <div class="encuesta-header">
      <h1 *ngIf="plantilla" class="encuesta-title">{{ plantilla.nombre || 'Encuesta de Satisfacci√≥n' }}</h1>
      <p *ngIf="plantilla && plantilla.centroAtencionId" class="encuesta-subtitle">Centro: {{ plantilla.centroAtencionId }}</p>
    </div>

    <!-- Formulario -->
    <form #encuestaForm="ngForm" *ngIf="plantilla && plantilla.preguntas" (ngSubmit)="enviar()" class="encuesta-form">
      <div *ngFor="let pregunta of plantilla.preguntas; let idx = index" class="pregunta-container">
        <label class="pregunta-label">{{ pregunta.textoPregunta }}</label>

      <div [ngSwitch]="pregunta.tipo">
        <!-- NPS 0-10 -->
        <div *ngSwitchCase="'NPS'" class="control-wrapper">
          <div class="nps-scale">
            <label *ngFor="let v of [0,1,2,3,4,5,6,7,8,9,10]" class="nps-option">
              <input type="radio" [name]="'pregunta_' + pregunta.id" [value]="v" [(ngModel)]="respuestas[pregunta.id]"
                required />
              <span class="nps-value">{{v}}</span>
            </label>
          </div>
          <div class="scale-labels">
            <small class="scale-label-start">Muy insatisfecho</small>
            <small class="scale-label-end">Muy satisfecho</small>
          </div>
        </div>

        <!-- RATING (1-5) para ESPERA -->
        <div *ngSwitchCase="'RATING_ESPERA'" class="control-wrapper">
          <div class="rating-scale">
            <label *ngFor="let v of [1,2,3,4,5]" class="rating-option">
              <input type="radio" [name]="'pregunta_' + pregunta.id" [value]="v" [(ngModel)]="respuestas[pregunta.id]"
                required />
              <span class="rating-star">‚≠ê</span>
              <span class="rating-value">{{v}}</span>
            </label>
          </div>
          <div class="scale-labels">
            <small class="scale-label-start">Muy largo</small>
            <small class="scale-label-end">Muy corto</small>
          </div>
        </div>

        <!-- RATING (1-5) para TRATO -->
        <div *ngSwitchCase="'RATING_TRATO'" class="control-wrapper">
          <div class="rating-scale">
            <label *ngFor="let v of [1,2,3,4,5]" class="rating-option">
              <input type="radio" [name]="'pregunta_' + pregunta.id" [value]="v" [(ngModel)]="respuestas[pregunta.id]"
                required />
              <span class="rating-star">‚≠ê</span>
              <span class="rating-value">{{v}}</span>
            </label>
          </div>
          <div class="scale-labels">
            <small class="scale-label-start">Muy malo</small>
            <small class="scale-label-end">Excelente</small>
          </div>
        </div>

        <!-- CSAT simple (1-5) -->
        <div *ngSwitchCase="'CSAT'" class="control-wrapper">
          <div class="csat-scale">
            <label *ngFor="let v of [1,2,3,4,5]" class="csat-option">
              <input type="radio" [name]="'pregunta_' + pregunta.id" [value]="v" [(ngModel)]="respuestas[pregunta.id]"
                required />
              <span class="csat-value">{{v}}</span>
            </label>
          </div>
          <div class="scale-labels">
            <small class="scale-label-start">Muy insatisfecho</small>
            <small class="scale-label-end">Muy satisfecho</small>
          </div>
        </div>

        <!-- TEXTO_LIBRE -->
        <div *ngSwitchCase="'TEXTO_LIBRE'" class="control-wrapper">
          <textarea class="form-control" [(ngModel)]="respuestas[pregunta.id]" [name]="'pregunta_' + pregunta.id"
            rows="4" placeholder="Comparta sus comentarios o sugerencias..."></textarea>
        </div>

        <!-- Tipo por defecto (texto simple) -->
        <div *ngSwitchDefault class="control-wrapper">
          <input class="form-control" type="text" [(ngModel)]="respuestas[pregunta.id]"
            [name]="'pregunta_' + pregunta.id" placeholder="Escriba su respuesta" />
        </div>
      </div>
    </div>

    <!-- Acciones del formulario -->
    <div class="form-actions">
      <button class="btn btn-primary" type="submit" [disabled]="submitted || encuestaForm.invalid">
        <span *ngIf="!submitted">Enviar Encuesta</span>
        <span *ngIf="submitted">Enviando...</span>
      </button>
      <button class="btn btn-secondary" type="button" (click)="goBack()">Cancelar</button>
    </div>
  </form>

  <!-- Estado vac√≠o -->
  <div *ngIf="!plantilla" class="empty-state">
    <div class="empty-state-icon">üìã</div>
    <p class="empty-state-message">No hay encuesta configurada para este turno.</p>
    <button class="btn btn-secondary" (click)="goBack()">Volver al Dashboard</button>
  </div>
  </div>
</div>

<div *ngIf="loading" class="loading-state">
  <div class="spinner-border" role="status">
    <span class="visually-hidden">Cargando...</span>
  </div>
  <p class="loading-message">Cargando encuesta...</p>
</div>